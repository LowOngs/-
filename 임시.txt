<!-- ğŸ“ŒTotal Pageviews â€“ Flip Plates (Monthly + Total) -->
<style>
  /* ì œëª©ì€ ë‹¤ë¥¸ ê°€ì ¯ê³¼ ë™ì¼í•˜ê²Œ í…Œë§ˆ ìƒ‰ì„ ìƒì† */
  .stats-board h3 { margin:0 0 6px 0; font-weight:600; color:inherit; text-align:left; }

  .stats-board{ margin:0; padding:0; text-align:left; display:flex; flex-direction:column; gap:0; }

  /* í”Œë¦½í˜• ì‚¬ê° í”Œë ˆì´íŠ¸ */
  .plate-row{ display:flex; align-items:center; gap:6px; line-height:1; }
  .digit-plate{
    display:inline-block; min-width:20px; padding:6px 8px;
    background:#000; color:#fff; font-weight:700; font-size:22px;
    border-radius:3px; box-shadow:0 2px 0 rgba(0,0,0,.35), inset 0 -2px 0 rgba(255,255,255,.08);
    text-align:center; letter-spacing:.5px; white-space:nowrap; user-select:none;
  }
  .digit-plate.comma{ min-width:12px; padding:6px 4px; opacity:.9; }
  .digit-plate.unit{ min-width:auto; padding:6px 6px; background:#111; opacity:.95; }

  /* ì›”ê°„(30ì¼) ìˆ«ìë§Œ ì´ˆë¡ìƒ‰ */
  .row-month .digit-plate{ color:#22bb33; }
  /* ì´ê³„ëŠ” ê¸°ë³¸ í°ìƒ‰ ìœ ì§€ */
</style>

<div class="widget-content stats-board">
  <!-- ìƒë‹¨: ì›”ê°„(30ì¼) -->
  <div class="row-month">
    <h3>ğŸ“ŒTotal Pageviews</h3>
    <div id="monthly_plate" class="plate-row" aria-label="Last 30 days"></div>
  </div>

  <!-- í•˜ë‹¨: ì´ê³„(ëˆ„ì /ì—°ê°„) â€“ ì œëª©/ë³´ì¡°ë¬¸êµ¬ ì œê±°, ì—¬ë°± 0 -->
  <div class="row-total">
    <div id="total_plate" class="plate-row" aria-label="All time total"></div>
  </div>
</div>

<script>
(function(){
  // âœ… ì˜¹ìŠ¤ë‹˜ Web App(exec) URLë¡œ êµì²´. ì‘ë‹µ ì˜ˆ: { "monthly": 1234567, "total": 987654321 }
  const API_URL = 'REPLACE_WITH_WEB_APP_URL';

  // === í‘œê¸° ì •ì±… ===
  // < 1M  : í’€ìˆ«ì(3ìë¦¬ ì½¤ë§ˆ)
  // 1M~1B : XM YK (ì†Œìˆ˜ì  ì—†ìŒ)
  // â‰¥1B   : XB YM (ì†Œìˆ˜ì  ì—†ìŒ)
  function blockFormatUS(n){
    n = (typeof n==='number' && isFinite(n) && n>0) ? Math.floor(n) : 0;

    // 1) 1M ë¯¸ë§Œ: ì½¤ë§ˆ í¬í•¨ í’€ìˆ«ì
    if(n < 1_000_000){
      return addCommas(n.toString()).split('').map(tok => ({t:tok, kind: tok===','?'comma':'digit'}));
    }

    // 2) 1M ~ 1B ë¯¸ë§Œ: XM YK
    if(n < 1_000_000_000){
      const M = Math.floor(n / 1_000_000);
      const K = Math.floor((n % 1_000_000) / 1_000);
      const arr = [];
      (M.toString()).split('').forEach(d=>arr.push({t:d, kind:'digit'}));
      arr.push({t:'M', kind:'unit'});
      if(K>0){
        arr.push({t:' ', kind:'space'});
        (K.toString()).split('').forEach(d=>arr.push({t:d, kind:'digit'}));
        arr.push({t:'K', kind:'unit'});
      }
      return arr;
    }

    // 3) 1B ì´ìƒ: XB YM
    const B = Math.floor(n / 1_000_000_000);
    const M = Math.floor((n % 1_000_000_000) / 1_000_000);
    const arr = [];
    (B.toString()).split('').forEach(d=>arr.push({t:d, kind:'digit'}));
    arr.push({t:'B', kind:'unit'});
    if(M>0){
      arr.push({t:' ', kind:'space'});
      (M.toString()).split('').forEach(d=>arr.push({t:d, kind:'digit'}));
      arr.push({t:'M', kind:'unit'});
    }
    return arr;
  }

  function addCommas(str){
    return str.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
  }

  function renderPlates(el, value){
    if(!el) return;
    const tokens = blockFormatUS(value);
    el.innerHTML = ''; // 0ë¶€í„° ì‹œì‘í•˜ë˜ ì¦‰ì‹œ ë Œë”
    tokens.forEach(({t,kind})=>{
      if(kind==='space'){ // ê°„ê²©ì€ ì‘ì€ ê³µë°±
        const s = document.createElement('span');
        s.style.width = '4px';
        el.appendChild(s);
        return;
      }
      const span = document.createElement('span');
      span.className = 'digit-plate' + (kind==='comma'?' comma': (kind==='unit'?' unit':'' ));
      span.textContent = t;
      el.appendChild(span);
    });
    if(tokens.length===0){ // ì•ˆì „ì¥ì¹˜: ê°’ ì—†ìœ¼ë©´ 0
      const z = document.createElement('span');
      z.className = 'digit-plate';
      z.textContent = '0';
      el.appendChild(z);
    }
  }

  // ì´ˆê¸° 0 ë Œë”(ìš”ì²­ ì „)
  renderPlates(document.getElementById('monthly_plate'), 0);
  renderPlates(document.getElementById('total_plate'), 0);

  // ì›¹ì•± ê°’ ë°˜ì˜ (ì—†ìœ¼ë©´ 0 ìœ ì§€)
  try{
    fetch(API_URL, {cache:'no-store'})
      .then(r=>r.json())
      .then(data=>{
        const monthly = (data && Number.isFinite(data.monthly)) ? data.monthly : 0;
        const total   = (data && (Number.isFinite(data.total) ? data.total
                          : Number.isFinite(data.yearly) ? data.yearly
                          : Number.isFinite(data.all) ? data.all : 0)) : 0;
        renderPlates(document.getElementById('monthly_plate'), monthly);
        renderPlates(document.getElementById('total_plate'), total);
      })
      .catch(()=>{ /* ì‹¤íŒ¨í•´ë„ 0 ìœ ì§€ */ });
  }catch(e){ /* ë¬´ì‹œ */ }
})();
</script>
