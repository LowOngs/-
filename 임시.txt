<!-- 📌Total Pageviews – Flip Plates (Monthly + Total) -->
<div id="statsBoard" style="margin:0;padding:0;text-align:left;display:flex;flex-direction:column;gap:0;">
  <!-- 상단: 월간(30일) 플레이트 -->
  <div id="monthly_plate" aria-label="Last 30 days" style="display:flex;align-items:center;gap:6px;line-height:1;"></div>
  <!-- 하단: 총계 플레이트(제목 없음, 바로 숫자) -->
  <div id="total_plate" aria-label="All time total" style="display:flex;align-items:center;gap:6px;line-height:1;"></div>
</div>

<script>
(function(){
  // ✅ 옹스님 Web App(exec) URL로 교체. 응답 예: { "monthly": 1234567, "total": 987654321 }
  var API_URL = 'REPLACE_WITH_WEB_APP_URL';

  // 0부터 보여주기
  renderPlates(document.getElementById('monthly_plate'), 0, /*isMonthly*/true);
  renderPlates(document.getElementById('total_plate'),   0, /*isMonthly*/false);

  // 웹앱 값 반영(없으면 0 유지)
  try{
    fetch(API_URL, {cache:'no-store'})
      .then(function(r){ return r.json(); })
      .then(function(data){
        var monthly = (data && isFinite(data.monthly)) ? Math.floor(data.monthly) : 0;
        var total   = (data && (isFinite(data.total) ? Math.floor(data.total)
                         : isFinite(data.yearly) ? Math.floor(data.yearly)
                         : isFinite(data.all) ? Math.floor(data.all) : 0)) : 0;
        renderPlates(document.getElementById('monthly_plate'), monthly, true);
        renderPlates(document.getElementById('total_plate'),   total,   false);
      })
      .catch(function(){ /* 실패 시 0 유지 */ });
  }catch(e){ /* 무시 */ }

  // === 표기 정책 ===
  // <1M  : 3자리 콤마 풀숫자
  // 1M~1B: XM YK  (소수점 없음)
  // ≥1B  : XB YM  (소수점 없음)
  function tokensUS(n){
    n = (isFinite(n) && n>0) ? Math.floor(n) : 0;
    if(n < 1e6){
      return addCommas(String(n)).split('').map(function(ch){
        return {t:ch, kind:(ch===','?'comma':'digit')};
      });
    }
    if(n < 1e9){
      var M = Math.floor(n/1e6);
      var K = Math.floor((n%1e6)/1e3);
      var arr=[];
      String(M).split('').forEach(function(d){ arr.push({t:d,kind:'digit'}); });
      arr.push({t:'M',kind:'unit'});
      if(K>0){
        arr.push({t:' ',kind:'space'});
        String(K).split('').forEach(function(d){ arr.push({t:d,kind:'digit'}); });
        arr.push({t:'K',kind:'unit'});
      }
      return arr;
    }
    var B = Math.floor(n/1e9);
    var M2= Math.floor((n%1e9)/1e6);
    var arr2=[];
    String(B).split('').forEach(function(d){ arr2.push({t:d,kind:'digit'}); });
    arr2.push({t:'B',kind:'unit'});
    if(M2>0){
      arr2.push({t:' ',kind:'space'});
      String(M2).split('').forEach(function(d){ arr2.push({t:d,kind:'digit'}); });
      arr2.push({t:'M',kind:'unit'});
    }
    return arr2;
  }

  function addCommas(s){ return s.replace(/\B(?=(\d{3})+(?!\d))/g, ','); }

  // 인라인 스타일 사각 플레이트 생성
  function makePlateSpan(text, kind, isMonthly){
    var span = document.createElement('span');
    var base = 'display:inline-block;min-width:20px;padding:6px 8px;background:#000;' +
               'font-weight:700;font-size:22px;border-radius:3px;' +
               'box-shadow:0 2px 0 rgba(0,0,0,.35), inset 0 -2px 0 rgba(255,255,255,.08);' +
               'text-align:center;letter-spacing:.5px;white-space:nowrap;user-select:none;';
    var color = isMonthly ? '#22bb33' : '#ffffff';
    if(kind==='comma'){ base += 'min-width:12px;padding:6px 4px;opacity:.9;'; }
    if(kind==='unit'){  base += 'background:#111;opacity:.95;'; }
    span.setAttribute('style', base + 'color:'+color+';');
    span.textContent = text;
    return span;
  }

  function renderPlates(el, val, isMonthly){
    if(!el) return;
    el.innerHTML='';
    var toks = tokensUS(val);
    if(!toks || !toks.length){ toks=[{t:'0',kind:'digit'}]; }
    for(var i=0;i<toks.length;i++){
      var tk = toks[i];
      if(tk.kind==='space'){
        var s=document.createElement('span'); s.setAttribute('style','width:4px;display:inline-block;');
        el.appendChild(s); continue;
      }
      el.appendChild(makePlateSpan(tk.t, tk.kind, isMonthly));
    }
  }
})();
</script>
