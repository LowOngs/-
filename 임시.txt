<!-- Saved Pages (max 10) â€“ paste this into an HTML/JavaScript gadget -->
<div id="savedPagesWidget" style="font:14px/1.4 system-ui, -apple-system, Segoe UI, Arial; color:#111;">
  <style>
    #spw-wrap{border:1px solid #e5e7eb;border-radius:12px;padding:12px;background:#fff}
    #spw-title{margin:0 0 8px 0;font-size:16px;font-weight:700}
    #spw-form{display:flex;gap:8px;margin:8px 0 10px 0}
    #spw-input{flex:1 1 auto;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px}
    #spw-add{padding:10px 12px;border:0;border-radius:10px;background:#2563eb;color:#fff;font-weight:700;cursor:pointer}
    #spw-msg{font-size:12px;color:#6b7280;min-height:18px}
    #spw-list{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px}
    .spw-item{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border:1px solid #e5e7eb;border-radius:999px;background:#f9fafb}
    .spw-id{font-weight:700}
    .spw-del{border:0;background:#ef4444;color:#fff;border-radius:8px;padding:4px 8px;cursor:pointer}
    #spw-actions{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    #spw-count{font-size:12px;color:#6b7280}
    #spw-clear{border:0;background:#111;color:#fff;border-radius:10px;padding:8px 10px;cursor:pointer}
    /* small flash for updates */
    .flash{animation:spwFlash .6s ease}
    @keyframes spwFlash{from{background:#fff2b3}to{background:transparent}}
  </style>

  <div id="spw-wrap">
    <h3 id="spw-title">Saved Pages</h3>

    <div id="spw-form">
      <input id="spw-input" type="text" placeholder="Type page id or URL (e.g., page123 or 123)" />
      <button id="spw-add" type="button">Save</button>
    </div>

    <div id="spw-msg"></div>

    <div id="spw-list"></div>

    <div id="spw-actions">
      <div id="spw-count"></div>
      <button id="spw-clear" type="button">Clear All</button>
    </div>
  </div>
</div>

<script>
(function(){
  const KEY = 'ongs.savedPages.v1';     // localStorage key
  const MAX = 10;

  const $ = (s, r=document) => r.querySelector(s);
  const wrap = $('#savedPagesWidget');
  const input = $('#spw-input', wrap);
  const btnAdd = $('#spw-add', wrap);
  const listEl = $('#spw-list', wrap);
  const msgEl  = $('#spw-msg', wrap);
  const countEl= $('#spw-count', wrap);
  const btnClr = $('#spw-clear', wrap);

  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      const arr = raw ? JSON.parse(raw) : [];
      return Array.isArray(arr) ? arr : [];
    }catch(e){ return []; }
  }
  function save(arr){
    localStorage.setItem(KEY, JSON.stringify(arr));
  }

  // Normalize input to "pageNNN"
  function parseToPageId(text){
    if(!text) return '';
    const t = String(text).trim();

    // 1) Full URL containing "page123"
    const mUrl = t.match(/page(\d{1,8})/i);
    if (mUrl) return 'page' + mUrl[1];

    // 2) Just "page123"
    const mPid = t.match(/^page(\d{1,8})$/i);
    if (mPid) return 'page' + mPid[1];

    // 3) Pure number -> pageNNN
    const mNum = t.match(/^\d{1,8}$/);
    if (mNum) return 'page' + mNum[0];

    return ''; // invalid
  }

  function setMsg(txt, isError=false){
    msgEl.textContent = txt || '';
    msgEl.style.color = isError ? '#ef4444' : '#6b7280';
  }

  function render(flashId){
    const items = load();
    listEl.innerHTML = '';
    items.forEach((id, idx)=>{
      const chip = document.createElement('div');
      chip.className = 'spw-item' + (flashId === id ? ' flash' : '');
      const strong = document.createElement('span');
      strong.className = 'spw-id';
      strong.textContent = id;

      const del = document.createElement('button');
      del.className = 'spw-del';
      del.textContent = 'Delete';
      del.addEventListener('click', ()=>{
        const arr = load().filter(x => x !== id);
        save(arr);
        render();
        setMsg('Deleted: ' + id);
      });

      chip.appendChild(strong);
      chip.appendChild(del);
      listEl.appendChild(chip);
    });
    countEl.textContent = items.length + ' / ' + MAX;
  }

  btnAdd.addEventListener('click', ()=>{
    const id = parseToPageId(input.value);
    if (!id) { setMsg('Invalid format. Use "page123", "123", or a URL containing page123.', true); return; }

    let arr = load();

    // If already exists -> move to front
    const existed = arr.includes(id);
    if (existed){
      arr = [id, ...arr.filter(x => x !== id)];
      save(arr);
      render(id);
      setMsg('Already saved. Moved to top: ' + id);
      input.value = '';
      return;
    }

    // Enforce max 10
    if (arr.length >= MAX){
      setMsg('You can save up to 10 items. Please delete some or clear all before adding.', true);
      return;
    }

    arr.unshift(id);
    save(arr);
    render(id);
    setMsg('Saved: ' + id);
    input.value = '';
  });

  btnClr.addEventListener('click', ()=>{
    if (!confirm('Clear all saved pages?')) return;
    save([]);
    render();
    setMsg('All cleared.');
  });

  // Enter key to add
  input.addEventListener('keydown', (e)=>{
    if (e.key === 'Enter') btnAdd.click();
  });

  // First render
  render();
  setMsg('Tip: You can paste a URL or type "page123" / just numbers.');
})();
</script>
