<!-- 📌Total Pageviews – Right-anchored Flip Plates (static fallback + JS replace) -->
<div id="statsBoard" style="margin:0;padding:0;text-align:left;">
  <!-- 상단: 월간(30일) — JS가 없어도 바로 보이는 정적 0 플레이트 -->
  <div id="monthly_wrap" aria-label="Last 30 days" style="margin:0;padding:0;text-align:right;">
    <span
      style="display:inline-block;min-width:20px;margin-left:6px;padding:6px 8px;background:#000;
             color:#22bb33;font-weight:700;font-size:22px;border-radius:3px;
             box-shadow:0 2px 0 rgba(0,0,0,.35), inset 0 -2px 0 rgba(255,255,255,.08);
             text-align:center;letter-spacing:.5px;white-space:nowrap;user-select:none;">0</span>
  </div>

  <!-- 하단: 총계 — JS가 없어도 바로 보이는 정적 0 플레이트 -->
  <div id="total_wrap" aria-label="All time total" style="margin:0;padding:0;text-align:right;">
    <span
      style="display:inline-block;min-width:20px;margin-left:6px;padding:6px 8px;background:#000;
             color:#ffffff;font-weight:700;font-size:22px;border-radius:3px;
             box-shadow:0 2px 0 rgba(0,0,0,.35), inset 0 -2px 0 rgba(255,255,255,.08);
             text-align:center;letter-spacing:.5px;white-space:nowrap;user-select:none;">0</span>
  </div>
</div>

<script>
(function(){
  // ✅ Web App(exec) URL로 교체. 응답 예: { "monthly": 1234567, "total": 987654321 }
  var API_URL = 'REPLACE_WITH_WEB_APP_URL';

  // <1M: 3자리 콤마, 1M~<1B: XM  YK, >=1B: XB  YM (소수점 없음, 미국식)
  function tokensUS(n){
    n = (isFinite(n) && n>0) ? Math.floor(n) : 0;

    if(n < 1000000){
      return addCommas(String(n)).split('');
    }
    if(n < 1000000000){
      var M = Math.floor(n/1000000);
      var K = Math.floor((n%1000000)/1000);
      var out = String(M) + 'M' + (K>0 ? (' ' + String(K) + 'K') : '');
      return out.split('');
    }
    var B = Math.floor(n/1000000000);
    var M2= Math.floor((n%1000000000)/1000000);
    var out2 = String(B) + 'B' + (M2>0 ? (' ' + String(M2) + 'M') : '');
    return out2.split('');
  }

  function addCommas(s){ return s.replace(/\B(?=(\d{3})+(?!\d))/g, ','); }

  // 인라인 스타일 플레이트 생성(월간=초록, 총계=흰색), 문자 종류에 따른 미세 스타일
  function makePlate(ch, isMonthly){
    var span = document.createElement('span');
    var base = 'display:inline-block;min-width:20px;margin-left:6px;padding:6px 8px;background:#000;'+
               'font-weight:700;font-size:22px;border-radius:3px;'+
               'box-shadow:0 2px 0 rgba(0,0,0,.35), inset 0 -2px 0 rgba(255,255,255,.08);'+
               'text-align:center;letter-spacing:.5px;white-space:nowrap;user-select:none;';
    var color = isMonthly ? '#22bb33' : '#ffffff';
    // 콤마는 좁게
    if(ch === ','){ base = base.replace('min-width:20px','min-width:12px').replace('padding:6px 8px','padding:6px 4px'); }
    // 단위(K/M/B)는 약간 더 어둡게
    if(ch === 'K' || ch === 'M' || ch === 'B'){
      base = base.replace('background:#000','background:#111');
    }
    // 공백은 작은 간격으로 대체
    if(ch === ' '){
      var sp = document.createElement('span');
      sp.setAttribute('style','display:inline-block;width:4px;');
      return sp;
    }
    span.setAttribute('style', base + 'color:'+color+';');
    span.textContent = ch;
    return span;
  }

  // 오른쪽(뒤)부터 채우기: 컨테이너는 text-align:right, 토큰은 왼→오 순으로 append
  function renderRow(wrapperId, value, isMonthly){
    var wrap = document.getElementById(wrapperId);
    if(!wrap) return;
    // 기본 0 플레이트를 교체
    while(wrap.firstChild){ wrap.removeChild(wrap.firstChild); }
    var tks = tokensUS(value);
    if(!tks || !tks.length){ tks = ['0']; }
    for(var i=0;i<tks.length;i++){
      wrap.appendChild(makePlate(tks[i], isMonthly));
    }
  }

  // JS가 전혀 안 도는 환경에서도 이미 0이 보이므로, 여기서 실패해도 화면은 유지됨.
  try{
    fetch(API_URL, {cache:'no-store'})
      .then(function(r){ return r.json(); })
      .then(function(data){
        var monthly = (data && isFinite(data.monthly)) ? Math.floor(data.monthly) : 0;
        var total   = (data && (isFinite(data.total) ? Math.floor(data.total)
                         : isFinite(data.yearly) ? Math.floor(data.yearly)
                         : isFinite(data.all) ? Math.floor(data.all) : 0)) : 0;
        renderRow('monthly_wrap', monthly, true);
        renderRow('total_wrap',   total,   false);
      })
      .catch(function(){ /* 실패 시 정적 0 유지 */ });
  }catch(e){ /* 무시 */ }
})();
</script>
